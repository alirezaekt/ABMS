<html>
<title>A BMS</title>
<meta charset="UTF-8">
<meta name="author" content="AlirezaEkt">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../stylesheets/bootstrap.css">

<link rel="stylesheet" href="../stylesheets/bootstrap.min.css">
<link rel="stylesheet" href="../stylesheets/bootstrap-toggle.min.css">

<script src="../javascripts/jquery-slim.js"></script>
<script src="../javascripts/popper.js"></script>
<script src="../javascripts/bootstrap.js"></script>
<script src="../javascripts/bootstrap-toggle.min.js"></script>
<link rel="stylesheet" href="../stylesheets/myboot.css">
<link rel="stylesheet" href="../stylesheets/mine.css">
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-sm navbar-light bg-light">
   <a class="navbar-brand" href="#">
    <img src="../images/logo.svg" width="30" height="30" class="d-inline-block align-top" alt="">
    BMS
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <a class="nav-link active" href="/">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/contacts">Contacts</a>
      </li>
        <li class="nav-item">
            <a class="nav-link" href="/videocall">VideoCall</a>
        </li>
      <li class="nav-item">
        <a class="nav-link" href="/settings">Settings</a>
      </li>
    </ul>  
  </div>
</nav>

<!-- Content -->
<div class="container">
    <div class="row rowmine">   
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
            Room1 <span>light1<br></span>
            <img src="../images/small-light-bulb.png" class="  nodeicon" alt="Responsive image" >
            <br><input type="checkbox"  checked data-toggle="toggle" id="r1l1">
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
            Room1 <span style="">temperature<br></span>
            <img src="../images/thermometer.svg" class="  nodeicon" alt="Responsive image" >
            <span class="nodeinfo" id="r1t1">23Â°C</span>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
                Room1 <span>light2<br></span>
                <img src="../images/bell-ringing.svg" class="  nodeicon" alt="Responsive image" >
                <br>
                <button id="r1l2">Ping</button>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
           Room1 <span>Fan<br></span>
            <img src="../images/fan-propellers.svg" class="  nodeicon" alt="Responsive image" >
            <br><input type="checkbox" checked data-toggle="toggle" id="r1f1">
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
            Room2 <span>light1<br></span>
            <img src="../images/small-light-bulb.png" class="  nodeicon" alt="Responsive image" >
            <br><input type="checkbox" checked data-toggle="toggle" id="r2l1">
            </div>
        </div>
        <div class="col-sm-12 col-md-8 col-lg-6 text-center ">
            <div class="smartnode">
            Room2 <span>light2<br></span>
            <img src="../images/small-light-bulb.png" class="  nodeicon" alt="Responsive image" >
            <br><input type="checkbox" unchecked data-toggle="toggle" id="lam1"><input type="checkbox" unchecked data-toggle="toggle" id="lam2"><input type="checkbox" unchecked data-toggle="toggle" id="lam3"><input type="checkbox" unchecked data-toggle="toggle" id="lam4">
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
            Room3 <span >valve<br></span>
            <img src="../images/industrial-pipe.svg" class="  nodeicon" alt="Responsive image" >
            <br><input type="checkbox" checked data-toggle="toggle" id="r3v1">
            </div>
        </div>    
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
            Room3 <span>light1<br></span>
            <img src="../images/small-light-bulb.png" class="  nodeicon" alt="Responsive image" >
            <br>
            <div class="progress" id="r3p1"><div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div></div>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
                Room3 <span>Curtain<br></span>
                <img src="../images/livingroom-curtain.svg" class="  nodeicon" alt="Responsive image" >
                <br><input type="checkbox" checked data-toggle="toggle" id="r3c1">
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3 text-center ">
            <div class="smartnode">
                Humidity Sensor <span><br></span>
                <img src="../images/humidity.svg" class="  nodeicon" alt="Responsive image" >
                <span class="nodeinfo" id="humsensor">34%</span>
            </div>
        </div>

    </div>
</div>

</body>

<script>
    $(".progress").click(function(e){
        var parentOffset = $(this).parent().offset();
        var relX = e.pageX - parentOffset.left;
        var percentageWitdth = parseInt(((relX-14)*100) / (parseInt($(this).css("width").split("px")[0])));
        $(this).children('.progress-bar').css({"width":percentageWitdth+"%"});
        $.ajax({
            url:''
        });
    });
</script>

<script src="../javascripts/socket.io.js"></script>

<script>
    var flag = 1 ;
    // $(document).ready(function(){
    //     setInterval(function(){
    //         getDatasFrequently()
    //     },600);
  //  });
    $('#lgg').click(function () {
        console.log("dokm");
    });
    $('body').on("click",".toggle",function () {
        if (flag == 1 ) {
            if ($(this).children('#r1l1')[0] !== undefined && $(this).children('#r1l1') !== "undefined") {
                if (this.className.split("off").length === 2) {
                    console.log("1on");
                    $.ajax({
                        url: '/serialp',
                    });
                }
                if (this.className.split("off").length === 1) {
                    console.log("1of");
                    $.ajax({
                        url: '/serialp2'
                    });
                }
            }
            if ($(this).children('#r2l1')[0] !== undefined && $(this).children('#r2l1') !== "undefined") {
                if (this.className.split("off").length === 2) {
                    console.log("2onnn")
                }
                if (this.className.split("off").length === 1) {
                    console.log("2offf")
                }
            }

            if ($(this).children('#lam1')[0] !== undefined && $(this).children('#lam1') !== "undefined") {
                console.log('ghable if');
                if (flag === 1) {
                    console.log('dakhele if', flag);
                    if (this.className.split("off").length === 2) {
                        $.ajax({
                            url: '/lamp1on',
                        });
                    }
                    if (this.className.split("off").length === 1) {
                        $.ajax({
                            url: '/lamp1off'
                        });
                    }
                }
                flag = 1;

            }


            if ($(this).children('#lam2')[0] !== undefined && $(this).children('#lam2') !== "undefined") {
                if (flag == 1) {

                    if (this.className.split("off").length === 2) {
                        $.ajax({
                            url: '/lamp2on',
                        });
                    }
                    if (this.className.split("off").length === 1) {
                        $.ajax({
                            url: '/lamp2off'
                        });
                    }
                }
                flag = 1;
            }

            if ($(this).children('#lam3')[0] !== undefined && $(this).children('#lam3') !== "undefined") {
                if (flag == 1) {

                    if (this.className.split("off").length === 2) {
                        $.ajax({
                            url: '/lamp3on',
                        });
                    }
                    if (this.className.split("off").length === 1) {
                        $.ajax({
                            url: '/lamp3off'
                        });
                    }
                }
                flag = 1;
            }
            if ($(this).children('#lam4')[0] !== undefined && $(this).children('#lam4') !== "undefined") {
                if (flag == 1) {

                    if (this.className.split("off").length === 2) {
                        $.ajax({
                            url: '/lamp4on',
                        });
                    }
                    if (this.className.split("off").length === 1) {
                        $.ajax({
                            url: '/lamp4off'
                        });
                    }
                }
                flag = 1;
            }

            // if($(this).children('#lam1')[0] !== undefined && $(this).children('#r2l1') !== "undefined")
            // {
            //     if( this.className.split("off").length ===2){
            //         var a1,a2,a3,a4;
            //         a1=1; a2=0; a3=0; a4=0;
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=1; }
            //         console.log(outk);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            //     if( this.className.split("off").length ===1){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=0; a4=0;
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            // }
            // if($(this).children('#lam2')[0] !== undefined && $(this).children('#r2l1') !== "undefined")
            // {
            //     if( this.className.split("off").length ===2){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=1; a3=0; a4=0;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a1=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            //     if( this.className.split("off").length ===1){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=0; a4=0;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a1=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            // }
            // if($(this).children('#lam3')[0] !== undefined && $(this).children('#r2l1') !== "undefined")
            // {
            //     if( this.className.split("off").length ===2){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=1; a4=0;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=2; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=4; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            //     if( this.className.split("off").length ===1){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=0; a4=0;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a1=1; }
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam4');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a4=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            // }
            // if($(this).children('#lam4')[0] !== undefined && $(this).children('#r2l1') !== "undefined")
            // {
            //     if( this.className.split("off").length ===2){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=0; a4=1;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a1=1; }
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            //     if( this.className.split("off").length ===1){
            //         var a1,a2,a3,a4;
            //         a1=0; a2=0; a3=0; a4=0;
            //         element = $('#lam1');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a1=1; }
            //         element = $('#lam2');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a2=1; }
            //         element = $('#lam3');
            //         if (element) { if (element.parents(".toggle")[0].className.split("off").length === 1) a3=1; }
            //         var outk=(8*a1)+(4*a2)+(2*a3)+(a4);
            //         $.ajax({
            //             url:'/serialpf',
            //             data: {
            //                 number : outk
            //             }
            //         });
            //     }
            //}
        }flag =1 ;
    });
function getDatasFrequently() {
    $.ajax({
        url: "getAllData",
        method: "GET",
        success: function (datas) {
            console.log(datas);

            $.each(datas, function (index, data) {
                var element = {};
                switch (data["number"]) {
                    case 1: {
                        element = $('#lam1');
                        if (element) {
                            if (element.parents(".toggle")[0].className.split("off").length === 1) {
                                if (data["value"] === 0){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                            else if (element.parents(".toggle")[0].className.split("off").length === 2) {
                                if (data["value"] === 1){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                        }
                    }
                        break;
                    case 2: {
                        element = $('#lam2');
                        if (element) {
                            if (element.parents(".toggle")[0].className.split("off").length === 1) {
                                if (data["value"] === 0){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                            else if (element.parents(".toggle")[0].className.split("off").length === 2) {
                                if (data["value"] === 1){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                        }
                    }
                        break;
                    case 3: {
                        element = $('#lam3');
                        if (element) {
                            if (element.parents(".toggle")[0].className.split("off").length === 1) {
                                if (data["value"] === 0){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                            else if (element.parents(".toggle")[0].className.split("off").length === 2) {
                                if (data["value"] === 1){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                        }
                    }
                        break;
                    case 4: {
                        element = $('#lam4');
                        if (element) {
                            if (element.parents(".toggle")[0].className.split("off").length === 1) {
                                if (data["value"] === 0){
                                    flag = 0;
                                    element.parents(".toggle").click();}
                            }
                            else if (element.parents(".toggle")[0].className.split("off").length === 2) {
                                if (data["value"] === 1){
                                    flag = 0;
                                    element.parents(".toggle").click();
                            }}
                        }
                    }
                        break;
                }
            });
        }
    });
}

</script>
<script>

    $('body').on("click",".toggle",function () {
        if($(this).children('#r1l1')[0] !== undefined && $(this).children('#r1l1') !== "undefined")
        {
            if( this.className.split("off").length ===2){
                console.log("1on");
                $.ajax({
                    url:'/serialp'

                });
            }
            if( this.className.split("off").length ===1){
                console.log("1of");
                $.ajax({
                    url:'/serialp2'
                });
            }
        }
        if($(this).children('#r2l1')[0] !== undefined && $(this).children('#r2l1') !== "undefined")
        {
            if( this.className.split("off").length ===2){
                console.log("2onnn")
            }
            if( this.className.split("off").length ===1){
                console.log("2offf")
            }
        }
    });
</script>
<script>
</script>
</html>